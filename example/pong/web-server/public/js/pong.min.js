!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b){var c=a("../../../index"),d=c.Client._extend({init:function e(){e._super.call(this)}});b.exports=d},{"../../../index":3}],3:[function(a,b){b.exports={Server:a("./src/ReckonerServer"),GameObject:a("./src/game/GameObject")}},{"./src/ReckonerServer":10,"./src/game/GameObject":12}],4:[function(a,b){b.exports=a("./src/HashArray.js")},{"./src/HashArray.js":5}],5:[function(a,b){var c=a("jclass"),d=c._extend({init:function(a,b,c){a=a instanceof Array?a:[a],this._map={},this._list=[],this.callback=b,this.keyFields=a,this.isHashArray=!0,this.options=c||{ignoreDuplicates:!1},b&&b("construct")},addOne:function(a){var b=!1;for(var c in this.keyFields){c=this.keyFields[c];var d=this.objectAt(a,c);if(d)if(this._map[d]){if(this.options.ignoreDuplicates)return;if(-1!=this._map[d].indexOf(a)){b=!0;continue}this._map[d].push(a)}else this._map[d]=[a]}b&&-1!=this._list.indexOf(a)||this._list.push(a)},add:function(){for(var a=0;a<arguments.length;a++)this.addOne(arguments[a]);return this.callback&&this.callback("add",Array.prototype.slice.call(arguments,0)),this},addAll:function(a){if(a.length<100)this.add.apply(this,a);else for(var b=0;b<a.length;b++)this.add(a[b]);return this},addMap:function(a,b){return this._map[a]=b,this.callback&&this.callback("addMap",{key:a,obj:b}),this},intersection:function(a){var b=this;if(!a||!a.isHashArray)throw Error("Cannot HashArray.intersection() on a non-hasharray object. You passed in: ",a);var c=this.clone(null,!0),d=this.clone(null,!0).addAll(this.all.concat(a.all));return d.all.forEach(function(d){b.collides(d)&&a.collides(d)&&c.add(d)}),c},complement:function(a){if(!a||!a.isHashArray)throw Error("Cannot HashArray.complement() on a non-hasharray object. You passed in: ",a);var b=this.clone(null,!0);return this.all.forEach(function(c){a.collides(c)||b.add(c)}),b},get:function(a){return this._map[a]instanceof Array&&1==this._map[a].length?this._map[a][0]:this._map[a]},getAll:function(a){if(a=a instanceof Array?a:[a],"*"==a[0])return this.all;var b=new d(this.keyFields);for(var c in a)b.add.apply(b,this.getAsArray(a[c]));return b.all},getAsArray:function(a){return this._map[a]||[]},getUniqueRandomIntegers:function(a,b,c){var d=[],e={};for(a=Math.min(Math.max(c-b,1),a);d.length<a;){var f=Math.floor(b+Math.random()*(c+1));e[f]||(e[f]=!0,d.push(f))}return d},sample:function(a,b){var c=this.all,d=[];b&&(c=this.getAll(b));for(var e=this.getUniqueRandomIntegers(a,0,c.length-1),f=0;f<e.length;f++)d.push(c[e[f]]);return d},has:function(a){return this._map.hasOwnProperty(a)},collides:function(a){for(var b in this.keyFields)if(this.has(this.objectAt(a,this.keyFields[b])))return!0;return!1},hasMultiple:function(a){return this._map[a]instanceof Array},removeByKey:function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b],d=this._map[c].concat();if(d){a=a.concat(d);for(var e in d){var f=d[e];for(var g in this.keyFields){var h=this.objectAt(f,this.keyFields[g]);if(h&&this._map[h]){var g=this._map[h].indexOf(f);-1!=g&&this._map[h].splice(g,1),0==this._map[h].length&&delete this._map[h]}}this._list.splice(this._list.indexOf(f),1)}}delete this._map[c]}return this.callback&&this.callback("removeByKey",a),this},remove:function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];for(var c in this.keyFields){var d=this.objectAt(b,this.keyFields[c]);if(d){var c=this._map[d].indexOf(b);-1!=c&&this._map[d].splice(c,1),0==this._map[d].length&&delete this._map[d]}}this._list.splice(this._list.indexOf(b),1)}return this.callback&&this.callback("remove",arguments),this},removeAll:function(){var a=this._list.concat();return this._map={},this._list=[],this.callback&&this.callback("remove",a),this},objectAt:function(a,b){if("string"==typeof b)return a[b];for(var c=b.concat();c.length&&a;)a=a[c.shift()];return a},forEach:function(a,b){a=a instanceof Array?a:[a];var c=this.getAll(a);return c.forEach(b),this},forEachDeep:function(a,b,c){a=a instanceof Array?a:[a];var d=this,e=this.getAll(a);return e.forEach(function(a){c(d.objectAt(a,b),a)}),this},clone:function(a,b){var c=new d(this.keyFields.concat(),a?a:this.callback);return b||c.add.apply(c,this.all.concat()),c},sum:function(a,b,c){var d=this,e=0;return this.forEachDeep(a,b,function(a,b){void 0!==c&&(a*=d.objectAt(b,c)),e+=a}),e},average:function(a,b,c){var d=0,e=0,f=0,g=this;return void 0!==c&&this.forEachDeep(a,c,function(a){f+=a}),this.forEachDeep(a,b,function(a,b){void 0!==c&&(a*=g.objectAt(b,c)/f),d+=a,e++}),void 0!==c?d:d/e},filter:function(a,b){function c(a){var c=e.objectAt(a,b);return void 0!==c&&c!==!1}var e=this,f="function"==typeof b?b:c,g=new d(this.keyFields);return g.addAll(this.getAll(a).filter(f)),g}});Object.defineProperty(d.prototype,"all",{get:function(){return this._list}}),Object.defineProperty(d.prototype,"map",{get:function(){return this._map}}),b.exports=d,"undefined"!=typeof window&&(window.HashArray=d)},{jclass:6}],6:[function(a,b,c){!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof c?(c=a(),"object"==typeof b&&(b.exports=c)):window?window.Class=a():"object"==typeof console&&console.error instanceof Function&&console.error("cannot determine environment")}(function(){var a=function(a){return a instanceof Function},b=function(a){return void 0===a},c=function(a){return"object"==typeof a},d=function(a){return c(a)&&a.descriptor===!0},e=function(a){var d,e,f,g,h=Array.prototype.slice.call(arguments,1);for(d in h){if(e=h[d],!c(e))return;for(f in e)g=a[f],b(g)&&(a[f]=e[f])}return a},f={_isClassObject:!1},g=!1,h=function(){};return h._subClasses=[],h._extend=function(c,i,j){b(c)&&(c={}),b(i)&&(i={}),b(j)&&(j={}),e(j,f);var k=this,l=function(){g||(this._class=l,this.init&&this.init.apply(this,arguments))};g=!0;var m=new k;g=!1;var n=k.prototype;l.prototype=m,l.prototype.constructor=l,l._superClass=k,l._subClasses=[],k._subClasses.push(l),l._extend=k._extend;var o,p,q;for(o in c)p=c[o],d(p)?Object.defineProperty(m,o,p):(m[o]=p,q=n[o],a(p)&&a(q)&&p!==q&&(p._super=q));if(!j._isClassObject){var r=b(k._members)?h:k._members._class,s={_isClassObject:!0},t=r._extend(i,{},s);l._members=new t}return l._extends=function(a){return this._superClass==h?!1:a==this._superClass||a==h?!0:this._superClass._extends(a)},l},h._convert=function(a,b){var c=a.prototype;return c.init=function(){this._origin=h._construct(a,arguments)},h._extend(c,{},b)},h._construct=function(a,b){var c=function(){return a.apply(this,b||[])};return c.prototype=a.prototype,new c},h})},{}],7:[function(a,b){!function(a){function c(a,b){if("object"!==e(a))return b;for(var d in b)a[d]="object"===e(a[d])&&"object"===e(b[d])?c(a[d],b[d]):b[d];return a}function d(a,b,d){var g=d[0],h=d.length;(a||"object"!==e(g))&&(g={});for(var i=0;h>i;++i){var j=d[i],k=e(j);if("object"===k)for(var l in j){var m=a?f.clone(j[l]):j[l];g[l]=b?c(g[l],m):m}}return g}function e(a){return{}.toString.call(a).slice(8,-1).toLowerCase()}var f=function(a){return d(a===!0,!1,arguments)},g="merge";f.recursive=function(a){return d(a===!0,!0,arguments)},f.clone=function(a){var b,c,d=a,g=e(a);if("array"===g)for(d=[],c=a.length,b=0;c>b;++b)d[b]=f.clone(a[b]);else if("object"===g){d={};for(b in a)d[b]=f.clone(a[b])}return d},a?b.exports=f:window[g]=f}("object"==typeof b&&b&&"object"==typeof b.exports&&b.exports)},{}],8:[function(a,b){function c(){c.init.call(this)}var d={};d.isObject=function(a){return"object"==typeof a&&null!==a},d.isNumber=function(a){return"number"==typeof a},d.isUndefined=function(a){return void 0===a},d.isFunction=function(a){return"function"==typeof a},b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(a){if(!d.isNumber(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,f,g,h;if(this._events||(this._events={}),"error"===a&&!this._events.error)throw b=arguments[1],b instanceof Error?b:Error('Uncaught, unspecified "error" event.');if(c=this._events[a],d.isUndefined(c))return!1;if(d.isFunction(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,f=new Array(e-1),g=1;e>g;g++)f[g-1]=arguments[g];c.apply(this,f)}else if(d.isObject(c)){for(e=arguments.length,f=new Array(e-1),g=1;e>g;g++)f[g-1]=arguments[g];for(h=c.slice(),e=h.length,g=0;e>g;g++)h[g].apply(this,f)}return!0},c.prototype.addListener=function(a,b){var e;if(!d.isFunction(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d.isFunction(b.listener)?b.listener:b),this._events[a]?d.isObject(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,d.isObject(this._events[a])&&!this._events[a].warned){var e;e=d.isUndefined(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,d.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),d.isFunction(console.trace)&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d.isFunction(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,f,g;if(!d.isFunction(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,e=-1,c===b||d.isFunction(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(d.isObject(c)){for(g=f;g-->0;)if(c[g]===b||c[g].listener&&c[g].listener===b){e=g;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d.isFunction(c))this.removeListener(a,c);else if(Array.isArray(c))for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d.isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d.isFunction(a._events[b])?1:a._events[b].length:0}},{}],9:[function(a,b){var c=a("jclass"),d=c._extend({setState:function(){},getState:function(){},getFPS:function(){return 30},getWorld:function(){return this.world},init:function(){},update:function(){},project:function(){}});b.exports=d},{jclass:6}],10:[function(a,b){(function(c){var d=a("hasharray"),e=(a("jclass"),a("./ReckonerBase")),f=30,g=.3,h=30,i=e._extend({init:function j(a){j._super.call(this),this.pomelo=a,this.messaging=a.get("messagingService"),this.games=new d("rid"),this.lastTime=void 0,this.elapsed=void 0,this.id="sid:"+Math.round(100*Math.random()).toString(16)+":"+c.pid,this.interval=void 0},getNow:function(){return(new Date).getTime()},addGame:function(a,b){a.messaging=this.messaging,a.clientUpdateTimer=0,a.rid=b,this.games.add(a)},sendState:function(){this.games.all.forEach(function(a){var b=this.pomelo.get("channelService").getChannel(a.rid,!1);b?b.pushMessage("serverState",a.getState()):console.log("WARNING: attempted to push to channel but does not exist",a.rid)})},start:function(){this.interval=setInterval(this.frameHandler.bind(this),1e3/f)},stopAll:function(){clearInterval(this.interval)},resetAll:function(){this.games.all.forEach(function(){game.reset(),game.start()})},frameHandler:function(){return this.lastTime?(this.elapsed=(this.getNow()-this.lastTime)/1e3,this.lastTime=this.getNow(),this.elapsed=this.elapsed>g?g:this.elapsed,this.games.forEach(function(a){a.serverUpdate(this.elapsed)}),this.clientUpdateTimer+=this.elapsed,void(this.clientUpdateTimer>h/1e3&&(this.sendState(),this.clientUpdateTimer=0))):this.lastTime=this.getNow()},session_userInputHandler:function(a,b){var c=this.games.get(a.rid);c?c.addUserInputForSession(b.uid,a):console.log("ERROR: unable to find game for rid: "+a.rid)},session_disconnectedHandler:function(a){console.log("SESSION DISCONNECTED:",a),this.game.world.players.removeByKey(a),this.game.world.getChildren().get(a).destroy(),0==this.game.world.getChildren().getAsArray("player").length&&this.reset()},session_connectedHandler:function(a,b){var c=this.games.get(b);return c?(c.startSession=c.startSession||a,c.addSession(a),void console.log("SESSION CONNECTED:",a.uid," to ",b)):void console.log("Attempted to connect to game that does not exist: "+b)}});b.exports=i}).call(this,a("_process"))},{"./ReckonerBase":9,_process:1,hasharray:4,jclass:6}],11:[function(a,b){{var c=a("jclass"),d=a("node-event-emitter");b.exports=c._extend(d.prototype)}},{jclass:6,"node-event-emitter":8}],12:[function(a,b){var c=a("merge"),d=a("./features/FeatureManager"),e=(a("jclass"),a("hasharray")),f=a("./EventDispatcher"),g=b.exports=f._extend({isServer:function(){return"undefined"==typeof window},stateSetProps:function(){return[]},stateGetProps:function(){return["_id"]},setParent:function(a){this._parent=a},getParent:function(){return this._parent},setChildren:function(a){this._children=a},getChildren:function(){return this._children},setId:function(a){this._id=a},getId:function(){return this._id||(this._id=this.randomId())},setState:function(a){this._state=a},getState:function(a){return this.inited?this.merge.recursive(!0,{id:this.getId(),type:this.type,children:this.getChildren().all.map(function(a){return a.getState()})},a):{}},getChildrenIds:function(){if(!this.inited)return{};var a={};return this.getChildren().all.forEach(function(b){a[b.getId()]=!0}),a},setChildrenState:function(a){var b=this,c=this.getChildrenIds();if(a.forEach(function(a){var d=b.getChildren().get(a.id);if(d){if("[object Array]"===Object.prototype.toString.call(d))return void console.log("Two ids are the same!",d[0].getId());d.setState(a)}else b.getChildren().add(b.newChildFromState(a));delete c[a.id]}),this.destroyUnfoundChildrenOnStateSet)for(var d in c)this.destroyChildById(d)},getChildrenState:function(){return this.inited?this.getChildren().all.map(function(a){return a.getState()}):{}},setDirty:function(a){this._dirty=a,this._dirty&&this.getParent()?this.getParent().setDirty(!0):"",this._dirty?"":this.getChildren().forEach(function(a){a.setDirty(!1)})},getDirty:function(){return this._dirty},emit:function(){this._super.apply(this,arguments);var a=this.getParent();a&&a.emit.apply(a,arguments)},randomId:function(){return Math.round(999999999*Math.random()).toString(16)},init:function(a,b){a||(g.prototype.world=g.prototype.root=this),this.merge=c,this.setId(b),this.type="GameObject",this.buildChildrenObject(),this.setParent(a),this.setDirty(!0),this.destroyed=!1,this.sprite=void 0,this.destroyUnfoundChildrenOnStateSet=!0,this.pre=new d(this),this.post=new d(this),this.inited=!0},update:function(a,b){b&&b.add(this);var c=this;this.pre.update(a),this.getChildren().all.concat().forEach(function(a){a.destroyed&&c.getChildren().remove(a)}),this.getChildren().all.forEach(function(c){c.update(a,b)}),this.post.update(a)},newChildFromState:function(a){var b=new g;return b.init(this,a.id),b.state=a,b},destroyChildById:function(a){var b=this.getChildren().get(a);return b?(b.destroy&&b.destroy(),void this.getChildren().remove(b)):void console.log("Attempting to destroy non-existent child with id",a)},buildChildrenObject:function(){this.setChildren(new e(["_id","type"]))},buildSprite:function(){},updateSprite:function(a){this.sprite&&this.destroyed?this.sprite.destroy(!0):(this.sprite||this.buildSprite(a),this.sprite&&this.sprite.updateWithModel(this))},updatePhaser:function(a){this.getChildren().all.forEach(function(b){b.updatePhaser(a)}),this.updateSprite(a)},destroy:function(){this.destroyed=!0},forEach:function(a,b){var c=b?this.getChildren().getAll(b):this.getChildren().all.concat();c.forEach(function(c){c.forEach(a,b)}),(!b||b.indexOf(this.type))&&a.apply(this)}})},{"./EventDispatcher":11,"./features/FeatureManager":13,hasharray:4,jclass:6,merge:7}],13:[function(a,b){var c=a("hasharray"),d=function(a){this.gameObject=a,this.features=new c(["name"])};d.prototype={cache:{},add:function(a){this.features.add(a)},update:function(a){var b=this;this.cache={},this.features.all.forEach(function(c){c.applyUpdate(b.gameObject,a,b.cache)})}},b.exports=d},{hasharray:4}]},{},[2]);